{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://smartworkar.github.io/swar-schemas/schemas/v1.2.3/process.schema.json",
  "version": "1.2.3",
  "type": "object",
  "title": "SWAR Process Definition",
  "description": "SWAR Version 1.2 process definition",
  "required": [
    "name",
    "activities",
    "roles"
  ],
  "additionalProperties": false,
  "properties": {
    "name": {
      "type": "string",
      "description": "The name of the process (a short description). This accepts variables from the InitialForm."
    },
    "description": {
      "type": "string",
      "description": "A detailed description of the process. This accepts variables from the InitialForm."
    },
    "title": {
      "type": "string",
      "description": "A one line description of the process (subject). This accepts variables from the InitialForm."
    },
    "roles": {
      "type": "array",
      "description": "Define which users categories can do the protocol and see its results.",
      "items": {
        "type": "string"
      }
    },
    "primaryKey": {
      "type": "array",
      "description": "Define which input parameter fields are considered a primary key of a process instance.",
      "items": {
        "type": "string"
      }
    },
    "options": {
      "type": "object",
      "description": "Additional ad hoc properties.",
      "properties": {
        "showQr": {
          "type": "boolean",
          "description": "The mission can be initiated from a device using a QR code."
        },
        "canEditOnFinish": {
          "type": "boolean",
          "description": "After completing a mission, it can be modified."
        },
        "canUploadBeforeFinish": {
          "type": "boolean",
          "description": "The mission can be partially uploaded to the server."
        },
        "mission_can_be_shared": {
          "type": "boolean",
          "description": "If a mission was created locally, it can be shared between users of the same category."
        },
        "canCreateOnDevice": {
          "type": "boolean",
          "description": "The mission can be created from the device. Default true."
        }
      },
      "additionalProperties": false
    },
    "activities": {
      "type": "object",
      "description": "The activities of the process. Entries with the format: {activity1: { Data for the activity}, ...}.",
      "minProperties": 2,
      "patternProperties": {
        "^[A-Za-z0-9_]+$": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "description": {
              "type": "string",
              "description": "A Description for the activity."
            },
            "instructions": {
              "description": "In SWAR 1.x an activity is defined by a map of instructions {id: instruction data}.",
              "type": "object",
              "minProperties": 1,
              "patternProperties": {
                "^[A-Za-z0-9_]+$": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "id": {
                      "type": "string",
                      "description": "The id of the instruction."
                    },
                    "description": {
                      "type": "string",
                      "description": "A description of the instruction."
                    },
                    "image": {
                      "type": "string",
                      "description": "A image associated with the instruction."
                    },
                    "attachments": {
                      "type": "array",
                      "description": "Documents attached to the current instruction, to be used as support documentation.",
                      "items": {
                        "type": "string"
                      }
                    },
                    "key": {
                      "type": "string"
                    },
                    "goal": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "values": {
                      "type": "object",
                      "properties": {
                        "right": {
                          "type": "string"
                        },
                        "wrong": {
                          "type": "string"
                        }
                      }
                    },
                    "subject": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "Instruction_Imagen": {
                      "type": "string"
                    },
                    "Instruction_XXX": {
                      "type": "string"
                    },
                    "Instruction_id": {
                      "type": "string"
                    },
                    "Instruction_text": {
                      "type": "string"
                    },
                    "Material adicional 1": {
                      "type": "string"
                    },
                    "Material adicional 2": {
                      "type": "string"
                    },
                    "Material adicional 3": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string"
                    },
                    "implementation": {
                      "description": "How the Instruction is implemented: form, photos, video, etc.",
                      "minProperties": 1,
                      "oneOf": [
                        {
                          "type": "object",
                          "required": [
                            "type",
                            "fields"
                          ],
                          "properties": {
                            "type": {
                              "type": "string",
                              "const": "form"
                            },
                            "title": {
                              "type": "string"
                            },
                            "key": {
                              "type": "string"
                            },
                            "fields": {
                              "type": "object",
                              "patternProperties": {
                                "^[a-zA-Z_][a-zA-Z0-9_]*$": {
                                  "type": "object",
                                  "additionalProperties": false,
                                  "properties": {
                                    "type": {
                                      "type": "string"
                                    },
                                    "required": {
                                      "type": "boolean"
                                    },
                                    "check": {
                                      "type": "string",
                                      "pattern": "^(validar(String|Fecha|InNumero|OutNumero|FechaUI)|VerificarMismoValor)\\(.+\\)[ ;]*$"
                                    },
                                    "placeholder": {
                                      "type": "string"
                                    },
                                    "origin": {
                                      "type": "string"
                                    },
                                    "width": {
                                      "type": "string"
                                    },
                                    "default": {
                                      "type": "string"
                                    },
                                    "rowId": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "required",
                                    "placeholder"
                                  ]
                                }
                              }
                            }
                          }
                        },
                        {
                          "type": "object",
                          "properties": {
                            "type": {
                              "const": "photos"
                            },
                            "photos": {
                              "type": "object",
                              "patternProperties": {
                                "^[a-zA-Z_][a-zA-Z0-9_]*$": {
                                  "type": "string"
                                }
                              }
                            }
                          },
                          "required": [
                            "type",
                            "photos"
                          ]
                        },
                        {
                          "type": "object",
                          "required": [
                            "type",
                            "description",
                            "quality"
                          ],
                          "properties": {
                            "type": {
                              "const": "video"
                            },
                            "description": {
                              "type": "string"
                            },
                            "quality": {
                              "type": "integer"
                            }
                          }
                        },
                        {
                          "type": "object",
                          "properties": {
                            "type": {
                              "const": "multipleChoice"
                            },
                            "message": {
                              "type": "string"
                            },
                            "questions": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "string"
                                  },
                                  "text": {
                                    "type": "string"
                                  },
                                  "answers": {
                                    "type": "array",
                                    "items": {
                                      "type": "string"
                                    }
                                  },
                                  "default": {
                                    "type": "string"
                                  },
                                  "height": {
                                    "type": "number"
                                  }
                                },
                                "required": [
                                  "id",
                                  "text",
                                  "answers"
                                ]
                              }
                            }
                          },
                          "required": [
                            "type",
                            "questions"
                          ]
                        },
                        {
                          "type": "object",
                          "properties": {
                            "type": {
                              "const": "doubleInput"
                            },
                            "description": {
                              "type": "string"
                            },
                            "labels": {
                              "type": "array",
                              "minItems": 2,
                              "items": {
                                "type": "string"
                              }
                            },
                            "referenceValue": {
                              "type": "string"
                            },
                            "tolerance": {
                              "type": "number"
                            }
                          },
                          "required": [
                            "type",
                            "description",
                            "labels",
                            "referenceValue",
                            "tolerance"
                          ]
                        },
                        {
                          "type": "object",
                          "properties": {
                            "type": {
                              "type": "string",
                              "const": "form2"
                            },
                            "title": {
                              "type": "string"
                            },
                            "fields": {
                              "type": "object",
                              "patternProperties": {
                                "^[a-zA-Z_][a-zA-Z0-9_]*$": {
                                  "type": "object",
                                  "additionalProperties": false,
                                  "properties": {
                                    "type": {
                                      "type": "string"
                                    },
                                    "options": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      }
                                    },
                                    "required": {
                                      "type": "boolean"
                                    },
                                    "label": {
                                      "type": "string"
                                    },
                                    "check": {
                                      "type": "string",
                                      "pattern": "^(validar(String|Fecha|InNumero|OutNumero|FechaUI)|VerificarMismoValor)\\(.+\\)[ ;]*$"
                                    },
                                    "placeholder": {
                                      "type": "string"
                                    },
                                    "origin": {
                                      "type": "string"
                                    },
                                    "width": {
                                      "type": "string"
                                    },
                                    "optionWidth": {
                                      "type": "string"
                                    },
                                    "default": {
                                      "type": "string"
                                    },
                                    "rowId": {
                                      "type": "string"
                                    }
                                  }
                                }
                              }
                            },
                            "expressions": {
                              "type": "object",
                              "patternProperties": {
                                "^[a-zA-Z_][a-zA-Z0-9_]*_(valid|enabled|visible)$": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                }
                              },
                              "description": "Expresiones de lógica para validar campos, habilitarlos o hacerlos visibles. El sufijo _valid, _enabled o _visible indica la regla a aplicar."
                            }
                          },
                          "required": [
                            "type",
                            "fields",
                            "expressions"
                          ]
                        },
                        {
                          "type": "object",
                          "properties": {
                            "type": {
                              "const": "approvalRequestPoint"
                            }
                          },
                          "required": [
                            "type"
                          ]
                        },
                        {
                          "type": "object",
                          "properties": {
                            "type": {
                              "const": "checkTolerance"
                            }
                          },
                          "required": [
                            "type"
                          ]
                        },
                        {
                          "type": "object",
                          "required": [
                            "type",
                            "image",
                            "fields"
                          ],
                          "properties": {
                            "type": {
                              "type": "string",
                              "const": "freeForm"
                            },
                            "image": {
                              "type": "string"
                            },
                            "fields": {
                              "type": "array",
                              "items": {
                                "properties": {
                                  "id": {
                                    "type": "string"
                                  },
                                  "type": {
                                    "type": "string"
                                  },
                                  "required": {
                                    "type": "boolean"
                                  },
                                  "check": {
                                    "type": "string",
                                    "pattern": "^(validar(String|Fecha|InNumero|OutNumero|FechaUI)|VerificarMismoValor)\\(.+\\)[ ;]*$"
                                  },
                                  "placeholder": {
                                    "type": "string"
                                  },
                                  "width": {
                                    "type": "string"
                                  },
                                  "height": {
                                    "type": "string"
                                  },
                                  "position": {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "number"
                                        },
                                        {
                                          "type": "string"
                                        }
                                      ]
                                    }
                                  }
                                }
                              },
                              "required": [
                                "id",
                                "type",
                                "required",
                                "placeholder"
                              ]
                            }
                          }
                        },
                        {
                          "type": "object",
                          "properties": {
                            "type": {
                              "const": "tripleInputPhoto"
                            },
                            "labels": {
                              "type": "array",
                              "minItems": 3,
                              "items": {
                                "type": "string"
                              }
                            },
                            "photoLabels": {
                              "type": "array",
                              "minItems": 3,
                              "items": {
                                "type": "string"
                              }
                            },
                            "validRange": {
                              "type": "array",
                              "minItems": 2,
                              "items": {
                                "type": "number"
                              }
                            },
                            "tolerancia": {
                              "type": "integer"
                            }
                          }
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "required": [
            "instructions"
          ]
        }
      },
      "required": [
        "InitialForm"
      ]
    }
  }
}